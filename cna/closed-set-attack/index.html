<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Closed Set Attack - CryptoNote Transaction Graph Analysis</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="requirements.html">Requirements</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Monero Analysis</li><li class="chapter-item expanded "><a href="download-blockchain.html"><strong aria-hidden="true">1.</strong> Download the Monero Blockchain</a></li><li class="chapter-item expanded "><a href="postgresql.html"><strong aria-hidden="true">2.</strong> Create PostgreSQL Tables</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pg-keyimage.html"><strong aria-hidden="true">2.1.</strong> Create Key Image Table</a></li><li class="chapter-item expanded "><a href="pg-outputs.html"><strong aria-hidden="true">2.2.</strong> Create Outputs Table</a></li><li class="chapter-item expanded "><a href="pg-edges.html"><strong aria-hidden="true">2.3.</strong> Create Edges Table</a></li></ol></li><li class="chapter-item expanded "><a href="create-graph.html"><strong aria-hidden="true">3.</strong> Create the Transaction Graph</a></li><li class="chapter-item expanded "><a href="dm-decomposition.html"><strong aria-hidden="true">4.</strong> DM Decomposition Analysis</a></li><li class="chapter-item expanded "><a href="closed-set-attack.html" class="active"><strong aria-hidden="true">5.</strong> Closed Set Attack</a></li><li class="chapter-item expanded affix "><li class="part-title">Analysing Monero using Hard Forks</li><li class="chapter-item expanded "><a href="hardforks.html"><strong aria-hidden="true">6.</strong> What and Why of Hard Forks</a></li><li class="chapter-item expanded "><a href="create-fork-indices-column.html"><strong aria-hidden="true">7.</strong> Create Fork Indices Column</a></li><li class="chapter-item expanded "><a href="download-hardforks.html"><strong aria-hidden="true">8.</strong> Download Hard Fork Data</a></li><li class="chapter-item expanded "><a href="monero-original/index.html"><strong aria-hidden="true">9.</strong> Use Monero Original Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="monero-original/run-client.html"><strong aria-hidden="true">9.1.</strong> Run Monero Original Client</a></li><li class="chapter-item expanded "><a href="monero-original/postgresql.html"><strong aria-hidden="true">9.2.</strong> Create PostgreSQL Tables</a></li><li class="chapter-item expanded "><a href="monero-original/output-addresses.html"><strong aria-hidden="true">9.3.</strong> Find Output Addresses</a></li><li class="chapter-item expanded "><a href="monero-original/ring-intersections.html"><strong aria-hidden="true">9.4.</strong> Find Ring Intersections</a></li></ol></li><li class="chapter-item expanded "><a href="monerov/index.html"><strong aria-hidden="true">10.</strong> Use MoneroV Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="monerov/compile-client.html"><strong aria-hidden="true">10.1.</strong> Compile MoneroV Client</a></li><li class="chapter-item expanded "><a href="monerov/run-client.html"><strong aria-hidden="true">10.2.</strong> Run MoneroV Client</a></li><li class="chapter-item expanded "><a href="monerov/postgresql.html"><strong aria-hidden="true">10.3.</strong> Create PostgreSQL Tables</a></li><li class="chapter-item expanded "><a href="monerov/output-addresses.html"><strong aria-hidden="true">10.4.</strong> Find Output Addresses</a></li><li class="chapter-item expanded "><a href="monerov/ring-intersections.html"><strong aria-hidden="true">10.5.</strong> Find Ring Intersections</a></li></ol></li><li class="chapter-item expanded "><a href="monero-v7/index.html"><strong aria-hidden="true">11.</strong> Use Monero v7 Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="monero-v7/run-client.html"><strong aria-hidden="true">11.1.</strong> Run Monero v7 Client</a></li><li class="chapter-item expanded "><a href="monero-v7/postgresql.html"><strong aria-hidden="true">11.2.</strong> Create PostgreSQL Tables</a></li><li class="chapter-item expanded "><a href="monero-v7/output-addresses.html"><strong aria-hidden="true">11.3.</strong> Find Output Addresses</a></li><li class="chapter-item expanded "><a href="monero-v7/ring-intersections.html"><strong aria-hidden="true">11.4.</strong> Find Ring Intersections</a></li></ol></li><li class="chapter-item expanded "><a href="monero-v9/index.html"><strong aria-hidden="true">12.</strong> Use Monero v9 Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="monero-v9/run-client.html"><strong aria-hidden="true">12.1.</strong> Run Monero v9 Client</a></li><li class="chapter-item expanded "><a href="monero-v9/postgresql.html"><strong aria-hidden="true">12.2.</strong> Create PostgreSQL Tables</a></li><li class="chapter-item expanded "><a href="monero-v9/output-addresses.html"><strong aria-hidden="true">12.3.</strong> Find Output Addresses</a></li><li class="chapter-item expanded "><a href="monero-v9/ring-intersections.html"><strong aria-hidden="true">12.4.</strong> Find Ring Intersections</a></li></ol></li><li class="chapter-item expanded "><a href="update-fork-indices-column.html"><strong aria-hidden="true">13.</strong> Update Fork Indices Column</a></li><li class="chapter-item expanded "><a href="hardfork-ringct.html"><strong aria-hidden="true">14.</strong> RingCT Analysis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hardfork-ringct-edges.html"><strong aria-hidden="true">14.1.</strong> Create Edges Table</a></li><li class="chapter-item expanded "><a href="hardfork-ringct-create-graph.html"><strong aria-hidden="true">14.2.</strong> Create the Transaction Graph</a></li><li class="chapter-item expanded "><a href="hardfork-ringct-dm-decomposition.html"><strong aria-hidden="true">14.3.</strong> DM Decomposition Analysis</a></li><li class="chapter-item expanded "><a href="hardfork-ringct-closed-set-attack.html"><strong aria-hidden="true">14.4.</strong> Closed Set Attack</a></li></ol></li><li class="chapter-item expanded "><a href="hardfork-nonringct.html"><strong aria-hidden="true">15.</strong> Non-RingCT Analysis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hardfork-nonringct-edges.html"><strong aria-hidden="true">15.1.</strong> Create Edges Table</a></li><li class="chapter-item expanded "><a href="hardfork-nonringct-create-graph.html"><strong aria-hidden="true">15.2.</strong> Create the Transaction Graph</a></li><li class="chapter-item expanded "><a href="hardfork-nonringct-dm-decomposition.html"><strong aria-hidden="true">15.3.</strong> DM Decomposition Analysis</a></li><li class="chapter-item expanded "><a href="hardfork-nonringct-closed-set-attack.html"><strong aria-hidden="true">15.4.</strong> Closed Set Attack</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CryptoNote Transaction Graph Analysis</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="closed-set-attack"><a class="header" href="#closed-set-attack">Closed Set Attack</a></h1>
<ol>
<li>
<p>Compile the Rust binaries by running <code>cargo build --release</code> (if not already done).</p>
</li>
<li>
<p>Perform the cascade attack first by running the following command.</p>
<pre><code>cargo run --release --bin cascade csparse-edges-1541236.txt rings-after-cascade-1541236.txt 10
</code></pre>
<blockquote>
<p><strong>Note</strong>: The significance of the arguments to <code>cascade</code> can be understood by running <code>cargo run -r --bin cascade -- --help</code> or <code> ./target/release/cascade --help</code>.</p>
</blockquote>
<p>The output should look like the following.</p>
<pre><code>Edge file read in 6.780508534s
Num keyimages = 23164745, Num public keys = 25126033
Zero-mixin rings before CA = 12209675
Zero-mixin rings after CA iteration 1 = 15985204. Time taken = 4.434802555s.
Zero-mixin rings after CA iteration 2 = 16285257. Time taken = 277.680441ms.
Zero-mixin rings after CA iteration 3 = 16322672. Time taken = 111.501964ms.
Zero-mixin rings after CA iteration 4 = 16328236. Time taken = 87.87365ms.
Zero-mixin rings after CA iteration 5 = 16329045. Time taken = 83.504531ms.
Zero-mixin rings after CA iteration 6 = 16329176. Time taken = 83.173992ms.
Zero-mixin rings after CA iteration 7 = 16329215. Time taken = 82.656612ms.
Zero-mixin rings after CA iteration 8 = 16329215. Time taken = 82.576734ms.
No change in number of traceable rings. Exiting cascade attack loop
</code></pre>
<p>The above output shows that 16329215 rings were traced by the cascade attack after 7 iterations. As there was no change in the number of traceable rings in the 8th iteration, the program exited.</p>
</li>
<li>
<p>Run the clustering algorithm attack by running the following command.</p>
<pre><code>cargo run --release --bin cluster rings-after-cascade-1541236.txt rings-after-cluster-1541236.txt
</code></pre>
<blockquote>
<p><strong>Note</strong>: The significance of the arguments to <code>cluster</code> can be understood by running <code>cargo run -r --bin cluster -- --help</code> or <code> ./target/release/cluster --help</code>.</p>
</blockquote>
<p>The output should look like the following. The key index values may be different.</p>
<pre><code>Rings file read in 6.888624255s
Ring sets created in 2.083401154s
Counted initial number of traceable rings in 87.942429ms
Number of traceable rings = 16329215
At beginning of clustering algorithm while loop
1: Cluster of size 491 found at key index 21441. Search iteration = 1
Number of blocks in fine decomposition: 485
Singletons (traceable keyimages): 484
2: Cluster of size 593 found at key index 21450. Search iteration = 1
Number of blocks in fine decomposition: 580
Singletons (traceable keyimages): 579
3: Cluster of size 555 found at key index 23092. Search iteration = 1
Number of blocks in fine decomposition: 538
Singletons (traceable keyimages): 537
4: Cluster of size 346 found at key index 33335. Search iteration = 1
Number of blocks in fine decomposition: 340
.
.
.
3009: Cluster of size 2 found at key index 22416538. Search iteration = 2
Number of blocks in fine decomposition: 1
Singletons (traceable keyimages): 0
3010: Cluster of size 2 found at key index 22868731. Search iteration = 2
Number of blocks in fine decomposition: 1
Singletons (traceable keyimages): 0
3011: Cluster of size 15 found at key index 22868933. Search iteration = 2
Number of blocks in fine decomposition: 1
Singletons (traceable keyimages): 0
3012: Cluster of size 8 found at key index 22868960. Search iteration = 2
Number of blocks in fine decomposition: 1
Singletons (traceable keyimages): 0
Number of traceable rings = 16334967
Number of closed sets = 8765
Number of singleton closed sets = 5752
Number of non-singleton closed sets = 3013
Closed set size histogram: {2: 2278, 3: 596, 4: 44, 5: 23, 6: 8, 7: 14, 8: 11, 9: 7, 10: 4, 11: 4, 12: 4, 13: 3, 14: 2, 15: 2, 16: 2, 17: 3, 18: 2, 20: 1, 21: 1, 43: 1, 50: 1, 55: 1}
Number of public keys in all sets = 13230
Number of public keys in non-singleton closed sets = 7478
Pre attack mixin histogram:
[16329215, 1416089, 2372296, 279613, 2369745, 186294, 73721, 13095, 23646, 13068, 87963]
Post attack mixin histogram:
[16334967, 1413031, 2370099, 279384, 2369606, 186257, 73690, 13086, 23615, 13071, 87939]
</code></pre>
<p>The above output can be interpreted as follows.</p>
<ul>
<li>The clustering algorithm renders 5752 transaction rings traceable. The number of traceable rings increases from 16329215 (after the cascade attack) to 16334967. In comparison, the DM decomposition had rendered 16335308 rings traceable, i.e. 341 rings more than the clustering algorithm.</li>
<li>There are 2278 closed sets of size 2, 596 closed sets of size 3, and so on. Note that the maximum size of a closed set found by the clustering algorithm is 55. In contrast, the largest closed set found by the DM decomposition is 122.</li>
</ul>
</li>
<li>
<p>To calculate statistics related to the clustering algorithm, run the following command.</p>
<pre><code>cargo run --release --bin stats_cla csparse-edges-1541236.txt rings-after-cascade-1541236.txt rings-after-cluster-1541236.txt
</code></pre>
<blockquote>
<p><strong>Note</strong>: The significance of the arguments to <code>stats_cla</code> can be understood by running <code>cargo run -r --bin stats_cla -- --help</code> or <code> ./target/release/stats_cla --help</code>.</p>
</blockquote>
<p>The output should look like the following.</p>
<pre><code>Edge file read in 6.987560875s
Num keyimages = 23164745, Num public keys = 25126033
Initial mixin histogram:
[12209675, 707786, 4496490, 1486593, 3242625, 319352, 432875, 21528, 30067, 17724, 200030]
Post cascade attack rings file read in 6.91789017s
Post cascade attack mixin histogram:
[16329215, 1416089, 2372296, 279613, 2369745, 186294, 73721, 13095, 23646, 13068, 87963]
Cascade traceable ring pre-attack mixin histogram:
[12209675, 625264, 1776192, 951984, 451230, 73980, 202100, 4282, 3490, 2162, 28856]
Pre-attack mixin histogram of rings traced by cascade attack
0 12209675
1 625264
2 1776192
3 951984
4 451230
5 73980
6 202100
7 4282
8 3490
9 2162
10 28856
Total number of rings traced by cascade attack = 16329215
Post clustering algorithm rings file read in 6.917414066s
Post clustering algorithm mixin histogram:
[16334967, 1413031, 2370099, 279384, 2369606, 186257, 73690, 13086, 23615, 13071, 87939]
Cluster traceable ring post-attack mixin histogram:
[12209675, 625641, 1779134, 952855, 451959, 74186, 202360, 4296, 3506, 2178, 29177]
Post-attack mixin histogram of rings traced by clustering algorithm
0 0
1 377
2 2942
3 871
4 729
5 206
6 260
7 14
8 16
9 16
10 321
Total number of rings traced by clustering algorithm = 5752
</code></pre>
<p>The above output can be interpreted as follows.</p>
<ul>
<li>Out of the 16329215 rings traced by the cascade attack, 12209675 had zero mixins (there were already traceable) before the attack, 625264 had one mixin before the attack, 1776192 had two mixins, and so on.</li>
<li>Out of the 5752 rings traced by the clustering algorithm, 377 had one mixin after the cascade attack and before the clustering algorithm was executed, 2942 had two mixins, and so on.</li>
<li>In the above histograms, we combine all mixin counts of 10 or more.
<ul>
<li>So 200030 corresponds to the number of transaction rings with 10 or more mixins before the cascade attack, 87963 is the same number after the cascade attack, and 87939 is the number of rings which had 10 or more mixins after the clustering algorithm was executed.</li>
<li>Similarly, 28856 is the number of rings traced by the cascade attack that had 10 or more mixins before the attack. And 321 is the number of rings traced by the clustering algorithm that had 10 or more mixins before the algorithm was executed.</li>
</ul>
</li>
</ul>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="dm-decomposition.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="hardforks.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="dm-decomposition.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="hardforks.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
